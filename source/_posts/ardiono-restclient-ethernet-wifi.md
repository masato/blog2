title: "ArduinoをEthernetでWR702Nモバイルルーターに接続してRESTクライアントにする"
date: 2015-04-18 16:42:26
categories:
 - IoT
tags:
 - Arduino
 - Wi-Fi
 - WR702N
 - モバイルルーター
description: Arduino Uno用のEthernetシールドにWiznet W5100 チップを搭載したW5100が安く買えました。セットアップしたWR702Nモバイルルーターと一緒に使いArduinoをRESTクライアントとして使うサンプルを書いてみます。Ethernet libraryを使ったサンプルはたくさん見つかるのでArduinoをネットワーク接続する勉強にはちょうど良いです。
---

Arduino Uno用のEthernetシールドにWiznet W5100 チップを搭載した[W5100](http://www.amazon.co.jp/dp/B00LJM3ROO/)が安く買えました。セットアップした[WR702Nモバイルルーター](/2015/04/17/tp-link-tl-wr702n-cheap-wifi/)と一緒に使いArduinoをRESTクライアントとして使うサンプルを書いてみます。[Ethernet library](http://www.arduino.cc/en/reference/ethernet)を使ったサンプルはたくさん見つかるのでArduinoをネットワーク接続する勉強にはちょうど良いです。

<!-- more -->

## MACアドレスの生成

[W5100](http://www.amazon.co.jp/dp/B00LJM3ROO/)にはMACアドレスが付いていません。ArduinoのスケッチではMACアドレスを指定する必要があるため別途用意します。
[Random MAC address generator for Arduino Ethernet Shield (static MAC generator)](http://blog.crox.net/archives/91-Random-MAC-address-generator-for-Arduino-Ethernet-Shield-static-MAC-generator.html)の記事に[https://ssl.crox.net/arduinomac](https://ssl.crox.net/arduinomac)というMACアドレスを生成してくれるサイトの紹介がありました。以下のようにMACアドレスを生成してコードのサンプルまで書いてくれます。

``` c
// 90:A2:DA:89:C8:50
// MAC address generated by https://ssl.crox.net/arduinomac/
// see http://blog.crox.net/archives/91-MAC-generator.html

byte mac[6] = { 0x90, 0xA2, 0xDA, 0x89, 0xC8, 0x50 };
```

## HTTPクライアントライブラリ

Arduino用のHTTPクライアントライブラリはいくつか見つかりました。

* [interactive-matter/HTTPClient](https://github.com/interactive-matter/HTTPClient)
* [amcewen/HttpClient](https://github.com/amcewen/HttpClient)
* [nmattisson/HttpClient](https://github.com/nmattisson/HttpClient)
* [csquared/arduino-restclient](https://github.com/csquared/arduino-restclient)

REST APIを実行することが主な用途のため[csquared/arduino-restclient](https://github.com/csquared/arduino-restclient)を使うことにします。

### csquared/arduino-restclient

ライブラリをリポジトリからlibrariesディレクトリに`git clone`します。

``` bash
$ cd ~/Documents/Arduino/libraries
$ git clone https://github.com/csquared/arduino-restclient.git RestClient
```

arduino-restclientのリポジトリにある[simple_GET.ino](https://github.com/csquared/arduino-restclient/blob/master/examples/simple_GET/simple_GET.ino)を例にしてMeshbluからstatusを取得するスケッチを書きます。

```cpp ~/Documents/Arduino/MesubluStatus/MesubluStatus.ino
#include <Ethernet.h>
#include <SPI.h>
#include "RestClient.h"

RestClient client = RestClient("meshblu.octoblu.com");

void setup() {
  Serial.begin(9600);
  byte mac[6] = { 0x90, 0xA2, 0xDA, 0x11, 0x34, 0x7E };
  Ethernet.begin(mac);
  Serial.println("Setup!");
  String response;
  int statusCode = client.get("/status", &response);
  Serial.println(response);
}

void loop() {
}
```

コンパイルしてArduinoに書き込みます。シリアルモニタを実行するとMesubluのステータスを取得します。

```
Setup!
{"meshblu":"online"}
```

![mesublu-status.png](/2015/04/18/ardiono-restclient-ethernet-wifi/mesublu-status.png)
